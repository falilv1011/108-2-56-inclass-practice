---
title: "2020-3-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## packages

安裝package
```{r}
install.packages(c("dplyr", "lubridate"))

```

```{r}
library(googlesheets4)
library(dplyr)
library(lubridate)
```

## Create object

```{r}
a <- 2
a = 2 # = 與 <-同義
```

```{r}
a
```

## variable

```{r}
my_108_total_credits <- 15
_108_total_credits <- 15
108_total_credits <- 15
_my_108_total_credits <- 15
my.108.total_credits <- 15
.108.total_credits <- 15 # 隱藏變數
.my.108.total_credits <- 15
我的108學年總學分數 <- 15
`我的108學年總學分數` <- 15 # 特殊名稱處理，`不是名稱的一部份
`.108.total_credits` <- 15
```

```{r}
`我的年紀` <- 20
my_age <- `我的年紀`
```

## Atomic vecter

```{r}
num1 <- 5
vNum1 <- c(2,5)
vNum2 <- c(2, num1)
```

Vecter stacking
```{r}
vNum1 <- c(-1,5)
vNum2 <- c(2,3)
vNum4 <- c() # 空向量
```

```{r}
vNum3 <- c(vNum2, vNum1)
vNum4 <- c(vNum4, vNum1) # 向量疊代 （recursive vector concatenate）
```

### Different types
```{r}
num1<-5 # 非整數
num2<-5L # 整數

num1Vector<-c(5,6,7)
num2Vector<-c(5L,6L,7L)
```

### Character
```{r}
char1<-"你好"
char2<-'你好'
```

使用class()查詢上述物件類別。
```{r}
class(char2)
```

查詢函數用法：

Script window: 游標放在函數名稱任何一個位置，按F1。
Console window: ?函數名稱 按enter。
右下角Help tab的放大鏡打函數名稱。


他說:"今天多了一個確診。"

```{r}
HeSaid<-'他說:"今天多了一個確診。"' #裡面有"外面要用' # run了之後\\稱為escape
```


```{r}
library(httr)
library(dplyr)
GET("https://api.github.com/repos/tpemartin/108-2-56-inclass-practice/commits") %>%
  content() %>%
  View()   #游標放在函數名稱任何一個位置，按F1，可查詢函數
```

```{r}
library(googlesheets4)
`出席狀況表單網址` <- "https://docs.google.com/spreadsheets/d/1EAG49qDKPWWi0ebkVr29TLrvVnoBPfkvxYY-J3xLAHY/edit#gid=458686645" # 缺乏定義值
ss <- as_sheets_id(`出席狀況表單網址`)
homework_sheet <- sheets_read(ss,sheet=1)
```


Logical
邏輯：
為「真」： T或TRUE (要全大寫)。
為「否」： F或FALSE (要全大寫)。
```{r}
logi1 <- c(T,TRUE,F,FALSE,FALSE)
```

邏輯值遇到數學運算時T會被當成1，而F會被當成0
```{r}
# 加總向量內的所有元素值。
sum(logi1)
```


typeof()
顯示atomic vector元素的基本認定型態，它代表電腦記憶體在儲存時真正看待的型態。
```{r}
num <- c(1.5, 2, 3)
int <- c(1L, 3L, -2L)
char <- c("1.5","2","3")
logi <- c(T,T,F)

typeof(num)
typeof(int)
typeof(char)
typeof(logi)
```

class()
依資料的螢幕顯示型態及能對它進行的操作所做的分類。
```{r}
class(num)
class(int)
class(char)
class(logi)
```


## Atomic Vector Extended

###factor: 類別資料
```{r}
factor(
  字串向量
)
```

```{r}
# 10位學生的主系
majors10_char <- c('經濟學系','社會學系','社會學系','經濟學系','經濟學系','社會學系','經濟學系','經濟學系','經濟學系','社會學系')

typeof(majors10_char)
class(majors10_char)
```


```{r}
majors10_factor <- factor(majors10_char)
# 或
majors10_factor <- factor(
  c('經濟學系','社會學系','社會學系','經濟學系','經濟學系','社會學系','經濟學系','經濟學系','經濟學系','社會學系')
)

typeof(majors10_factor)
class(majors10_factor)
```

majors10_char及majors10_factor的螢幕顯示型態是不同的：
```{r}
majors10_char
```

```{r}
majors10_factor
```

as.integer()將資料的class轉成integer。由於factor被轉成integer後，其螢幕顯示會顯示電腦是用什麼數字在存這些類別資料。
```{r}
as.integer(majors10_factor) 
```

數字與類別文字的對照表mapping table:
```{r}
levels(majors10_factor)
```
levels() 顯示的類別名稱(categorical values) 順序整數值是R真正儲存的內容 例如說在這邊 社會學系會存成1 而經濟學系會存成2

### Date/Time

POSIXct/POSIXt: 時間資料
```{r}
ymd_hms(
  字串向量
)
```

台北
2020-03-18 13:52:40

時間輸入方式: ymd_hms
時間來自時區: Asia/Taipei

```{r}
tpeTime <- ymd_hms("2020-03-18 13:52:40",
        tz="Asia/Taipei")
```

我們使用lubridate中的ymd_hms函數有以下兩種做法：
作法一：使用library()
```{r}
library(lubridate)
tpeTime <- ymd_hms("2020-03-18 13:52:40",
        tz="Asia/Taipei")
```
作法二：不使用library()
```{r}
tpeTime <- lubridate::ymd_hms("2020-03-18 13:52:40",
        tz="Asia/Taipei")
```

葡萄牙
Mar.18, 2020, 05:52:40

時間輸入方式: mdy_hms
時間來自時區: Europe/Lisbon

```{r}
pgTime <- mdy_hms("Mar.18, 2020, 05:52:40",
                  tz="Europe/Lisbon")
```


來自相同時區、相同輸入方式的時間文字字串，可以直接套入相同函數轉成Date/Time類別。
```{r}
tpeTime <- c("2020-03-18 13:52:40",
             "2020-03-11 03:12:40")
tpeTime <- 
  ymd_hms(
    tpeTime, # 呼叫tpeTime向量值
    tz="Asia/Taipei"
    )
```
相當於
```{r}
tpeTime <- 
  ymd_hms(
    c("2020-03-18 13:52:40","2020-03-11 03:12:40"),
    tz="Asia/Taipei"
    )
```


若時間字串來自UTC，那可以不設定tz參數，即
```{r}
ymd_hms(
c("2020-03-18 13:52:40","2020-03-11 03:12:40")
)
```

若時間字串長得像“2020-03-11T06:56:17Z”，它來自UTC時區：
```{r}
ymd_hms("2020-03-11T06:56:17Z")
```


以某個時區顯示

以UTC表示
```{r}
with_tz(tpeTime, tzone="UTC")
with_tz(pgTime, tzone="UTC")
```

以Europe/Paris表示
```{r}
with_tz(tpeTime, tzone="Europe/Paris")
with_tz(pgTime, tzone="Europe/Paris")
```


小心以下兩函數的input中一個是tz，一個是tzone
```{r}
ymd_hms(..., tz="Asia/Taipei")
with_tz(..., tzone="Asia/Taipei")
```


type
```{r}
class(tpeTime)
typeof(tpeTime)

as.numeric(tpeTime)
as.numeric(pgTime)
```
Date/Time的儲存其實是數值，它的原點是UTC時區的1970-01-01 00:00:00。 as.numeric(tpeTime)的值顯示tpeTime離那個原點已過了多少秒。



## List
```{r}
vecterExample <- c(2, 6, 7)
listExample <- list(2, 6, 7)

print(vecterExample)
print(listExample)
```

每個元素值可以是不同type的物件值
```{r}
# 用vecter儲存
c("2020-03-31T13:40:55Z",
  "一芳",
  "2",
  "水果茶")

# 用list儲存
library(lubridate)
`小明交易1` <- list(   #小明交易是特殊物件要用反頓點`
  ymd_hms("2020-03-31T13:40:55Z"), # Date/Time class
  "一芳", # character
  2, # numeric
  "水果茶" # character
)
print(`小明交易1`)
```

物件值可以是vector形式，也可以list
```{r}
# 用vecter
c(
  c("108學年第1學期", "高級會計學", "高等統計學"),  #向量1
  c("108學年第2學期", "食在拉丁美洲")  #向量2
)
```

```{r}
# 用list
list( 
  c("108學年第1學期", "高級會計學", "高等統計學"),  #向量1
  c("108學年第2學期", "食在拉丁美洲")  #向量2
  )
```


```{r}
# list含兩個vectors
`小明108學年課表A` <- list(
  c("108-1","高級會計學","高等統計學"),
  c("108-2","食在拉丁美洲")
)
print(`小明108學年課表A`)
```


```{r}
# list含兩個lists
`小明108學年課表B` <- list(
  list("108-1","高級會計學","高等統計學"),
  list("108-2","食在拉丁美洲")
)
print(`小明108學年課表B`)
str(`小明108學年課表B`)
```

```{r}
# list含兩個lists, 子層list又各含兩個vectors
`小明108學年課表C` <- list(
  list(
    c("108-1"), # 可只寫 "108-1"
    c("高級會計學","高等統計學")
       ),
  list(
    c("108-2"),
    c("食在拉丁美洲")
  )
)
print(`小明108學年課表C`)
```

物件值可以取名
```{r}
# list含兩個lists, 子層list又各含兩個vectors
`小明108學年課表C` <- list(          
 `上學期`=list(            
    `108學年第1學期`=c("108-1"), # 可只寫 "108-1"  # 將108學年第一學期的lists取名108學年第1學期
    courses=c("高級會計學","高等統計學")           # 取名稱時=把它想成<-，名稱在<-左邊
       ),
  `下學期`=list(            
    `108學年第2學期`=c("108-2"),                   # 將108學年第二學期的lists取名108學年第2學期
    courses=c("食在拉丁美洲")                      # 將課程的list取名courses
  )                                                # run了之後遇到取名會用$表示
)
print(`小明108學年課表C`)
```

## Github Commit

```{r}
commit <- list(
  author=list(                         
    name="Martin老師",                   # 物件值可以取名
    email="mtlin@gm.ntpu.edu.tw", 
    time=ymd_hms("2020-03-25T07:17:40Z")
    ),                                   # author和committer用list比較好，因為有時間要用date/time class
  committer=list(
    name="emilyluckey", 
    email="emily007@gmail.com",
    time=ymd_hms("2020-03-26T08:18:40Z")
    ),
  message="update"                       # 用C或List都可以 # c括號寫不寫都可，因為只是一個簡單的字update
)
print(commit)
```


```{r}
library(jsonlite) # 不少同學這行會有Error，還記得如何排除嗎？
toJSON(commit)
```


## 3.7物件儲存

```{r}
save(commit,listExample,`小明108學年課表C`, file="today.Rda")
```

```{r}
load("today.Rda")
```


## 選取元素

### 選「一個元素」

#### 用位置選`[[.]]`

```{r}
vectorExample <- c("小明","小英","大雄")

# 有多少位置可選：
length(vectorExample)   #顯示有幾個值，此例會跑出3
```

```{r}
vectorExample[[1]]
vectorExample[[3]]
```


```{r}
listExample <- 
  list(
    student="小明",
    `學期`=list(
      `108-1`=list(
        list(
          name="個體經濟學",
          teacher="Alice",
          grade=85
        )
      ),
      `108-2`=list(
        list(
          name="總體經濟學",
          teacher="Mark",
          grade=78
        )
      )
    )
  )
# 有多少位置可選：
length(listExample)
```

```{r}
listExample[[1]]
listExample[[2]]
```

```{r}
install.packages('curl')
```


```{r}
library(jsonlite)
fromJSON("https://data.tainan.gov.tw/dataset/4cd9345a-04bf-4328-a97d-314ff78b4763/resource/afc025fc-1ef4-447c-b785-a680391d0ca1/download/tnsport2.json", simplifyDataFrame = F) -> tainanSportsMap

length(tainanSportsMap)
```

```{r}
tainanSportsMap[[1]]
tainanSportsMap[[1076]]
```

#### 用名字選`$.`

```{r}
#有多少名字可選:
names(listExample)   #此例會跑出student和學期
```

```{r}
listExample$student
listExample$`學期` # 特殊命名依然要用反頓點呼叫
```

```{r}
str(listExample)
```

```{r}
str(listExample$`學期`)
```


其實也可以用[["名字"]]來選，只是名字要以字串「值」的方式來寫，也就是要用引號一對"…", 不用反頓點一對`…`。
```{r}
listExample[["student"]]
listExample$student

listExample[["學期"]] # 小心不是反頓點喔。
listExample$`學期`
```

```{r}
student <-"student"
listExample[[student]]
```


[新北市各區衛生所之門診時間及疫苗種類彙整表]
```{r}
fromJSON("http://data.ntpc.gov.tw/api/v1/rest/datastore/382000000A-000157-002",
         simplifyDataFrame = F) -> newTaipeiCityVaccine
```

```{r}
str(newTaipeiCityVaccine)
length(newTaipeiCityVaccine)
names(newTaipeiCityVaccine)
```

```{r}
str(newTaipeiCityVaccine[[1]])
str(newTaipeiCityVaccine$success)
str(newTaipeiCityVaccine[["success"]])

str(newTaipeiCityVaccine[[2]], max.level = 1)
str(newTaipeiCityVaccine$result, max.level = 1)
str(newTaipeiCityVaccine[["result"]], max.level = 1)
```

### 選「多個元素」

#### 用位置選`[c(...)]`

```{r}
vectorExample
vectorExample[c(1,3)]
vectorExample[c(3,2,1)] # 產生重新排列效果
```

```{r}
# 顯示到第一層
str(listExample, max.level=1)

str(listExample[c(1,2)], max.level = 1)
str(listExample[c(2,1)], max.level = 1)
```

任選數筆tainanSportsMap的運動地點。
```{r}
str(tainanSportsMap, max.level = 1)
str(tainanSportsMap[c(1,382,1076)], max.level = 1)
```

#### 用名字選`[c("name1","name2",...)]`{-}

```{r}
# 顯示到第一層
str(listExample, max.level=1)

listExample[["學期"]]   
listExample[c("student","學期")]
listExample[c("學期","student")]
```

臺北市夜市資料（來自臺北市食材登錄平台食材來源資訊）
```{r}
fromJSON("https://www.dropbox.com/s/qnm9bnz7vccrvcz/taipeiNightMarkets.json?dl=1", simplifyDataFrame = F) -> taipeiNightMarkets
```
任選幾個夜市元素出來。
```{r}
taipeiNightMarkets[c(1,3,5)]
taipeiNightMarkets[c("寧夏觀光夜市","廣州街觀光夜市","西昌街觀光夜市")]
```

```{r}
names(taipeiNightMarkets)
length(taipeiNightMarkets)
```

#### 用「要/不要」邏輯向量選`[c(T,T,F,...)]`{-}

```{r}
vectorExample
vectorExample[c(T,T,F)] # 要，要，不要
```

```{r}
str(listExample)
str(listExample[c(F,T)]) # 不要，要
str(listExample[c("學期")])    # 430和431是一樣的
str(listExample[c(T,T)]) # 要，要
```

用「要/不要」邏輯向量自taipeiNightMarkets選出 寧夏觀光夜市，西昌街觀光夜市，大龍街夜市， 雙城街夜市。
```{r}
names(taipeiNightMarkets)
```

```{r}
c(T,F,F,F,T,
  F,F,F,F,T,
  F,F,F,T) -> selectedMarkets
taipeiNightMarkets[selectedMarkets]

str(taipeiNightMarkets[c(T,F,F,F,T,
  F,F,F,F,T,
  F,F,F,T)], max.level = 1)
```

```{r}
selectedMarkets <- rep(F,14)  # repeat F by 14 times
print(selectedMarkets)
selectedMarkets[c(1,5,10,14)] <- TRUE  #replacement
print(selectedMarkets)
```

```{r}
str(taipeiNightMarkets[selectedMarkets], max.level = 1)
```



```{r}
str(listExample, max.level = 3)
```

```
listExample: length=2, list class
  |
  |--student: length=1, character class
  |
  |--學期: length=3, list class
```
以下兩個表面都是選取“學期”:
```{r}
get1 <- listExample[["學期"]]
get2 <- listExample["學期"]
```

*`[[]]`: 拿出某個物件值

```{r}
# get1 # 學期拿出來，有3個元素的list
str(listExample, max.level = 3)
```

```{r}
get1 <- listExample[["學期"]]
str(get1, max.level = 1)
```

*`[]`: 留下某個物件值

```{r}
# get1 # 學期拿出來，有3個元素的list
str(listExample, max.level = 3)
```

```{r}
get2 <- listExample["學期"] # listExample 只留下 學期元素，是個只有一個元素的list
str(get2, max.level = 1)
str(get2, max.level = 2)
```

差別比較看以下3個:
```{r}
str(listExample, max.level = 3)
```

```{r}
str(get1, max.level = 1)
```

```{r}
str(get2, max.level = 2)
```


### 連鎖選取


```{r}
numVector <- c(2,3,6,-1,4,2,6)
select1 <- numVector[c(1,4)]; select1  #就是2和-1
select2 <- select1[[1]]; select2  #就是2

# 相當於
numVector[c(1,4)][[1]]
```


```{r}
select1 <- numVector[c(T,T,F,T,F,F,T)]; select1
select2 <- select1[c(1,4)]; select2

# 相當於
numVector[c(T,T,F,T,F,F,T)][c(1,4)]
```


```{r}
majors <- c("經濟學系","經濟學系","社會學系","社工系","經濟學系")
names <- c("小英", "小美", "大雄","阿華", "阿尼")
gender <- c("F","F","M","F","M")

econOnly <- c(T,T,F,F,T)
names[econOnly]
gender[econOnly]
econFemaleOnly <- gender[econOnly][c(T,T,F)] 
names[econOnly][c(T,T,F)]
```
創造出只要“經濟學系”學生的邏輯向量，econOnly。
選出econOnly的names與gender。
在econOnly的gender下創造出只要“F”的邏輯向量, econFemaleOnly。
選出names中為“經濟學系”且“F”的姓名。



在前面討論使用[[ ]]（同$）及[ ]取一個元素時我們創造了get1與get2兩個物件，請分別由get1, get2取出108-1學期個體經濟學教師姓名。
```{r}
get1 <- listExample[["學期"]] #拿出來
get2 <- listExample["學期"] #只留下

names(get1)
names(get2)
```

```{r}
str(get1)
```

```{r}
str(get2)
```

練習答案:
自己寫:
```{r}
get1$`108-1`[[1]][[2]]
get2$`學期`[[1]][[1]][[2]]
```
老師寫:
```{r}
listExample[["學期"]]$`108-1`[[1]]$teacher
listExample["學期"][[1]][["108-1"]][[1]]$teacher
```


```{r}
get1 <- listExample[["學期"]] #拿出來
get2 <- listExample["學期"] #只留下
```


## list應用
```{r}
vector1 <- c(a=1,b=3,c=4)
vector1[["a"]]
vector1[c("a","c")]
list1$a #不能用

list1 <- list(a=1,b=3,c=4)
list1[["a"]]
list1[c("a","c")]
list1$a
```


```{r}
today <- list(
  list("台北市",
       highest_temp=c(highest_temp = 25), #atomic vector也可以命名
       lowest_temp=c(lowest_temp = 18)),
  list("新北市",
       highest_temp=c(highest_temp = 24),
       lowest_temp=c(lowest_temp = 15)))

str(today)
```
```{r}
today[[1]]$highest_temp  #為何繼續保留vector裡的highest_temp?因為選取並執行後會顯示highest_temp和25
```


```{r}
tomorrow <- list(
  list("台北市", c(highest_temp = 25),c(lowest_temp = 18)),
  list("新北市",c(highest_temp = 24),c(lowest_temp = 15)))
  

weather <- list(today,tomorrow)

print(weather)
```









